<!--pages/naozi/naozi.wxml-->
<!-- 互动点子库 - 脑子tab页面 -->

<view class="container">
  <!-- 标题区域 -->
  <view class="title-section">
    <text class="main-title">🧠 脑子游戏 🎮</text>
    <text class="sub-title">挑战你的思维能力</text>
  </view>

  <!-- 游戏入口区 -->
  <view class="game-entrances">
    <button class="game-btn game24-btn" bindtap="toggleGame24">
      🎯 24点算术
    </button>
    <button class="game-btn mahjong-btn" bindtap="toggleMahjong">
      🀄 麻将胡牌
    </button>
  </view>

  <!-- 24点算术区域 -->
  <view class="game24-area" wx:if="{{showGame24}}">
    <view class="game24-header">
      <text class="game24-title">🎯 24点算术</text>
      <button class="game24-close" bindtap="toggleGame24">✕</button>
    </view>
    
    <view class="game24-rules">
      <text class="game24-rule-text">使用下面4个数字，通过 +、-、×、÷ 和括号，计算出24</text>
    </view>

    <!-- 显示4个数字 -->
    <view class="game24-numbers">
      <view class="game24-number" wx:for="{{game24Numbers}}" wx:key="index">
        {{item}}
      </view>
    </view>

    <!-- 输入表达式 -->
    <view class="game24-input-section">
      <text class="game24-input-label">输入你的算式：</text>
      <input 
        class="game24-input" 
        type="text" 
        placeholder="例如：(9 × 8) - (8 × 3)"
        value="{{game24Expression}}"
        bindinput="onGame24Input"
        confirm-type="done"
      />

      <!-- 24点算术虚拟键盘：点击符号直接插入到输入框 -->
      <view class="game24-keyboard">
        <!-- 数字行 -->
        <view class="game24-key-row">
          <button class="game24-key" data-value="1" bindtap="insertGame24Symbol">1</button>
          <button class="game24-key" data-value="2" bindtap="insertGame24Symbol">2</button>
          <button class="game24-key" data-value="3" bindtap="insertGame24Symbol">3</button>
          <button class="game24-key" data-value="4" bindtap="insertGame24Symbol">4</button>
          <button class="game24-key" data-value="5" bindtap="insertGame24Symbol">5</button>
        </view>
        <view class="game24-key-row">
          <button class="game24-key" data-value="6" bindtap="insertGame24Symbol">6</button>
          <button class="game24-key" data-value="7" bindtap="insertGame24Symbol">7</button>
          <button class="game24-key" data-value="8" bindtap="insertGame24Symbol">8</button>
          <button class="game24-key" data-value="9" bindtap="insertGame24Symbol">9</button>
          <button class="game24-key" data-value="10" bindtap="insertGame24Symbol">10</button>
        </view>

        <!-- 运算符 + 括号 -->
        <view class="game24-key-row">
          <button class="game24-key" data-value="+" bindtap="insertGame24Symbol">＋</button>
          <button class="game24-key" data-value="-" bindtap="insertGame24Symbol">－</button>
          <button class="game24-key" data-value="×" bindtap="insertGame24Symbol">×</button>
          <button class="game24-key" data-value="÷" bindtap="insertGame24Symbol">÷</button>
          <button class="game24-key" data-value="(" bindtap="insertGame24Symbol">(</button>
          <button class="game24-key" data-value=")" bindtap="insertGame24Symbol">)</button>
        </view>

        <!-- 编辑功能键：删除 / 清空 -->
        <view class="game24-key-row">
          <button class="game24-key wide" data-action="backspace" bindtap="insertGame24Symbol">⌫ 删除</button>
          <button class="game24-key wide" data-action="clear" bindtap="insertGame24Symbol">清空</button>
        </view>
      </view>

      <view class="game24-buttons">
        <button class="game24-submit-btn" bindtap="submitGame24">提交答案</button>
        <button class="game24-new-btn" bindtap="newGame24">换一组数字</button>
        <button class="game24-answer-btn" bindtap="showGame24Answer">查看答案</button>
      </view>
    </view>

    <!-- 提示信息 -->
    <view class="game24-message" wx:if="{{game24Message}}">
      <text class="game24-message-text {{game24MessageType}}">{{game24Message}}</text>
    </view>
  </view>

  <!-- 麻将胡牌区域 -->
  <view class="mahjong-area" wx:if="{{showMahjong}}">
    <view class="mahjong-header">
      <text class="mahjong-title">🀄 麻将胡牌</text>
      <button class="mahjong-close" bindtap="toggleMahjong">✕</button>
    </view>
    
    <view class="mahjong-rules">
      <text class="mahjong-rule-text">请选择13张万子牌，点击"判定胡牌"按钮计算可胡的牌</text>
    </view>

    <!-- 万子牌选择区 -->
    <view class="mahjong-tiles-section">
      <text class="mahjong-tiles-label">选择万子牌（一-九万）：</text>
      <view class="mahjong-tiles">
        <button 
          wx:for="{{[1,2,3,4,5,6,7,8,9]}}" 
          wx:key="index"
          class="mahjong-tile"
          bindtap="addMahjongTile"
          data-tile="{{item}}"
        >
          <view class="mahjong-tile-content">
            <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
            <text class="mahjong-tile-suit">萬</text>
          </view>
        </button>
      </view>
    </view>

    <!-- 手牌展示区 -->
    <view class="mahjong-hand-section">
      <text class="mahjong-hand-label">当前手牌（{{mahjongHand.length}}张）：</text>
      <scroll-view class="mahjong-hand-scroll" scroll-x="true" show-scrollbar="false">
        <view class="mahjong-hand">
          <view 
            wx:for="{{mahjongHand}}" 
            wx:key="index"
            class="mahjong-hand-tile"
            bindtap="removeMahjongTile"
            data-index="{{index}}"
          >
            <view class="mahjong-tile-content">
              <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
              <text class="mahjong-tile-suit">萬</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 操作按钮区 -->
    <view class="mahjong-buttons">
      <button class="mahjong-clear-btn" bindtap="clearMahjongHand">清空手牌</button>
      <button class="mahjong-check-btn" bindtap="startHuGuess" disabled="{{mahjongHand.length !== 13}}">
        开始猜胡
      </button>
    </view>

    <!-- 猜胡区：让用户选择可以胡的牌 -->
    <view class="mahjong-guess-section" wx:if="{{showGuessSection}}">
      <text class="mahjong-guess-title">请选择您认为可以胡的牌：</text>
      <view class="mahjong-guess-tiles">
        <view wx:for="{{[1,2,3,4,5,6,7,8,9]}}" wx:key="index" class="mahjong-hand-tile guessable-tile" bindtap="toggleGuessTile" data-tile="{{item}}">
          <view class="mahjong-tile-content">
            <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
            <text class="mahjong-tile-suit">萬</text>
          </view>
          <view wx:if="{{guessedTiles.indexOf(item) !== -1}}" class="mahjong-tile-selected"></view>
        </view>
      </view>
      
      <!-- 用户选择的牌显示区 -->
      <view class="mahjong-selected-tiles-section">
        <text class="mahjong-selected-tiles-label">您已选择：</text>
        <view class="mahjong-selected-tiles">
          <view wx:for="{{guessedTiles}}" wx:key="index" class="mahjong-hand-tile">
            <view class="mahjong-tile-content">
              <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
              <text class="mahjong-tile-suit">萬</text>
            </view>
          </view>
          <text wx:if="{{guessedTiles.length === 0}}" class="mahjong-selected-tiles-empty">未选择任何牌</text>
        </view>
      </view>
      
      <button class="mahjong-guess-confirm-btn" bindtap="confirmGuess">确定选择</button>
    </view>

    <!-- 猜胡结果区 -->
    <view class="mahjong-guess-result" wx:if="{{guessResult}}">
      <text class="mahjong-guess-result-title">{{guessResult.title}}</text>
      <text class="mahjong-guess-result-message">{{guessResult.message}}</text>
      <view wx:if="{{guessResult.correct}}" class="mahjong-guess-result-correct">
        <text class="mahjong-guess-result-correct-text">正确可胡牌：</text>
        <view class="mahjong-result-tiles">
          <view wx:for="{{correctHuCards}}" wx:key="index" class="mahjong-hand-tile">
            <view class="mahjong-tile-content">
              <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
              <text class="mahjong-tile-suit">萬</text>
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="mahjong-guess-attempts">
        <text class="mahjong-guess-attempts-text">剩余尝试次数：{{3 - wrongAttempts}}</text>
      </view>
      <!-- 全部猜对时不显示重新猜胡按钮 -->
      <button wx:if="{{!guessResult.correct && wrongAttempts < 3}}" class="mahjong-guess-reset-btn" bindtap="resetGuess">重新猜胡</button>
      <!-- 猜错3次后显示公布答案按钮 -->
      <button wx:if="{{!guessResult.correct && wrongAttempts >= 3}}" class="mahjong-guess-answer-btn" bindtap="showAnswer">公布答案</button>
    </view>

    <!-- 答案显示区 -->
    <view class="mahjong-answer-section" wx:if="{{showAnswerSection}}">
      <text class="mahjong-answer-title">正确答案：</text>
      <text class="mahjong-answer-message">不要灰心，下次一定可以猜对！</text>
      <view class="mahjong-result-tiles">
        <view wx:for="{{correctHuCards}}" wx:key="index" class="mahjong-hand-tile">
          <view class="mahjong-tile-content">
            <text class="mahjong-tile-number">{{['', '一', '二', '三', '四', '五', '六', '七', '八', '九'][item]}}</text>
            <text class="mahjong-tile-suit">萬</text>
          </view>
        </view>
        <text wx:if="{{correctHuCards.length === 0}}" class="mahjong-result-empty">无（此手牌无法胡牌）</text>
      </view>
      <button class="mahjong-guess-reset-btn" bindtap="resetGuess">重新开始</button>
    </view>

    <!-- 规则说明区 -->
    <view class="mahjong-rule-section">
      <text class="mahjong-rule-title">规则说明：</text>
      <view class="mahjong-rule-list">
        <text class="mahjong-rule-item">1. 常规胡牌：4组顺子/刻子 + 1对将牌</text>
        <text class="mahjong-rule-item">2. 七对胡牌：7个不同的对子</text>
        <text class="mahjong-rule-item">3. 顺子：如123万，刻子：如555万，将牌：如77万</text>
      </view>
    </view>
  </view>

  <!-- 联系我们区域 -->
  <view class="contact-section">
    <text class="contact-text">联系我们：736923621@qq.com</text>
  </view>
</view>